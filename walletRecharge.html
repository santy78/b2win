<!DOCTYPE html>
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <link rel="shortcut icon" href="images/favicon.png" type="">

  <title> B2WIN.AI </title>

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

  <!-- fonts style -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!--owl slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

  <!-- font awesome style -->
  <link href="css/font-awesome.min.css" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <!-- responsive style -->
  <link href="css/responsive.css" rel="stylesheet" />
  <style type="text/css">
    .box{
      padding: 10px 0 0 0 !important;
    }
    #loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .spinner {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #fff;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
  </style>
</head>

<body class="sub_page">

  <div class="hero_area">

    <div class="hero_bg_box">
      <div class="bg_img_box">
        <img src="images/hero-bg.png" alt="">
      </div>
    </div>

    <!-- header section strats -->
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <span>
              B2WIN.AI
            </span>
          </a>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class=""> </span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav  ">
             
              <li class="nav-item">
                <a class="nav-link" href="profile.html">Profile</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="logout();">Logout</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!-- end header section -->
  </div>
  <!-- team section -->
  <section class="team_section" style="padding: 25px; 0">
    <div class="container-fluid">
      <div class="heading_container heading_center">
        <h2 class="">
          Recharge
        </h2>
      </div>
<div class="team_container">
        <div class="row justify-content-center">
          
          <div class="col-lg-10 col-sm-8">
  <div class="box">
    <div class="additional-details" style="margin:20px;text-align: left!important;">
         <h3>Enter Recharge Amount (in Rs)</h3>
          <input type="text" id="pointAmount" class="form-control" placeholder="Enter amount" name="">
          <div class="row" style="margin-top: 20px;">
            <div class="col-md-10">
              <span style="color: green;"> (Minimum Rs. 10 and Maximum 10000) </span>
            </div>
          </div><br>

          <button class="btn btn-primary" onclick="addPoint();"> Recharge</button>

    </div>
  </div>
  

</div>


</div>

          
          
        </div>
      </div>
  </section>

<div id="loader" style="display: none;">
  <div class="spinner"></div>
</div>

  <section class="team_section" style="padding-top: 25px;">
  </section>
  <!-- end info section -->

  <!-- footer section -->
  <section class="footer_section">
    <div class="container">
      <p>
        &copy; <span id="displayYear"></span> All Rights Reserved By
        <a href="https://html.design/">Free Html Templates</a>
      </p>
    </div>
  </section>

  <!-- jQery -->
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <!-- popper js -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
  <!-- bootstrap js -->
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <!-- owl slider -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js">
  </script>
  <!-- custom js -->
  <script type="text/javascript" src="js/custom.js"></script>
  <!-- Google Map -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap">
  </script>
  <!-- End Google Map -->
<script type="text/javascript">
  var token;
  var name="";
  var phone="";
  var address="";

    document.addEventListener("DOMContentLoaded", function () {
    // Retrieve the access token from local storage
    const accessToken = localStorage.getItem("b2Win_access_token");

    if (accessToken!="") {
      if (isTokenExpired(accessToken)) {
    console.log("Token is expired. Redirecting to login...");
    window.location.href = "index.html";
    // Redirect to login page or take appropriate action
    } else {
        console.log("Token is valid. Proceed to dashboard...");
        token=accessToken;
        // Proceed to the dashboard or desired action
    }
      const decodedToken = jwt_decode(accessToken);
    console.log(decodedToken);
        // If the access token exists, redirect to the dashboard
       // window.location.href = "dashboard.html";
    } else {
        // If no access token, redirect to the login page
        window.location.href = "index.html";
    }
});

function isTokenExpired(token) {
    try {
        // Decode the token
        const payload = JSON.parse(atob(token.split(".")[1].replace(/-/g, "+").replace(/_/g, "/")));

        // Get the current time in seconds
        const currentTime = Math.floor(Date.now() / 1000);

        // Check if the token is expired
        return payload.exp < currentTime; // true if expired, false otherwise
    } catch (error) {
        console.error("Invalid JWT token:", error.message);
        return true; // Assume invalid tokens are expired
    }
}

function logout() {
  localStorage.removeItem("b2Win_access_token");
    localStorage.removeItem("b2Win_refresh_token");
    localStorage.removeItem("b2Win_uid");
    localStorage.removeItem("b2Win_email");
    localStorage.removeItem("b2Win_referralCode");

    window.location.href = "index.html";
}


$("#updateProfileBtn").click(function () {
$("#showInfo").hide("slow");
$("#updateInfo").show("slow");
});


$("#transationsHistoryBtn").click(function () {
  $("#rechargeHistory").hide("slow");
  $("#transationsHistory").show("slow");
});

$("#rechargeHistoryBtn").click(function () {
  $("#transationsHistory").hide("slow");
  $("#rechargeHistory").show("slow");
});

function addPoint() {
    var point=$("#pointAmount").val();
    if(point<10 || point>10000){
        alert("amount should be more then 10 and less then 10000");
    }else{
    const url = "https://test.api.itisiya.com:8443/b2winai/e-wallet/transaction/add_points?amount="+point; 
    showLoader();
    $.ajax({
        url: url,
        method: "POST",
        contentType: "application/json; charset=UTF-8",
        headers: {

        "x-token": token // Retrieve the token from localStorage
    },
        success: function (response) {
            console.log("response:", response);
             hideLoader();
            if (response.statuscode === 200) {
              
              alert(response.message);
              setTimeout(function () {// Replace #loginDiv with the actual ID of your login div
                       window.location.href = "profile.html"; // Optionally hide the registration div if needed
                    }, 100);

            } else {
                console.error("failed with status:", response.statuscode, response.message);
                alert("Failed: " + response.message);
            }
        },
        error: function (xhr, status, error) {
           hideLoader();
            console.error("Failed:", xhr.responseText || error);
        }
    });
    }
}




function showLoader() {
  $("#loader").show();
}

function hideLoader() {
  $("#loader").hide();
}
</script>
</body>

</html>